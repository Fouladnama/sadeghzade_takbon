"use strict";exports.id=619,exports.ids=[619],exports.modules={73619:(e,r,l)=>{l.d(r,{A:()=>_});var i=l(60687),t=l(43210),a=l(51060),o=l(28274),n=l(78678),d=l(69482),s=l(30150),c=l(51110),x=l(93031),h=l(91676),f=l(20981),u=l(54648),p=l(47181),m=l(17361),g=l(47140),b=l(4060),j=l(55236),A=l(70998),y=l(87643),v=l(47121),k=l(20255),C=l(62523);l(25806);var w=l(93530);let R=(0,t.forwardRef)(function(e,r){return(0,i.jsx)(w.A,{direction:"up",ref:r,...e})}),S=({col:e,formValues:r,imageFiles:l,uploadProgress:t,onImageChange:a,onTitleChange:s})=>(0,i.jsxs)(o.A,{mb:3,children:[(0,i.jsx)(n.A,{variant:"subtitle1",gutterBottom:!0,fontWeight:"600",color:"primary",children:e.header}),(0,i.jsxs)(o.A,{sx:{border:"2px dashed",borderColor:t>0&&t<100?"primary.main":"grey.400",borderRadius:2,p:2,cursor:"pointer",display:"flex",alignItems:"center",gap:2,bgcolor:t>0&&t<100?"rgba(25, 118, 210, 0.1)":"transparent",transition:"all 0.3s ease","&:hover":{borderColor:"primary.dark",bgcolor:"rgba(25, 118, 210, 0.15)"}},onClick:()=>document.getElementById(`upload-input-${e.field}`).click(),role:"button",tabIndex:0,onKeyPress:()=>document.getElementById(`upload-input-${e.field}`).click(),children:[(0,i.jsx)(k.P4e,{size:32,color:"#1976d2"}),(0,i.jsxs)(n.A,{variant:"body1",color:"textSecondary",children:["برای آپلود ",e.header," کلیک کنید یا فایل را بکشید اینجا رها کنید"]}),(0,i.jsx)("input",{id:`upload-input-${e.field}`,type:"file",accept:"image/*",onChange:a,style:{display:"none"}})]}),t>0&&t<100&&(0,i.jsxs)(o.A,{mt:1,children:[(0,i.jsx)(d.A,{variant:"determinate",value:t,color:"primary"}),(0,i.jsxs)(n.A,{variant:"body2",color:"primary",fontWeight:"600",mt:.5,children:["پیشرفت آپلود: ",t,"%"]})]}),l&&(0,i.jsxs)(o.A,{mt:2,display:"flex",alignItems:"center",gap:2,children:[(0,i.jsx)(o.A,{sx:{border:"2px dashed",borderColor:t>0&&t<100?"primary.main":"grey.400",borderRadius:3,p:2,cursor:"pointer",display:"flex",alignItems:"center",gap:2,background:"rgba(255,255,255,0.15)",backdropFilter:"blur(8px)",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",transition:"all 0.35s ease","&:hover":{borderColor:"primary.dark",background:"rgba(25,118,210,0.1)",boxShadow:"0 6px 24px rgba(25,118,210,0.2)"}}}),(0,i.jsx)(o.A,{flexGrow:1,children:r[e.field]&&(0,i.jsxs)(n.A,{variant:"caption",color:"success.main",sx:{fontWeight:600},children:["کلید فایل: ",r[e.field]]})})]})]}),W=({url:e,columns:r,onClose:l,onAdd:d,open:w})=>{let[W,z]=(0,t.useState)({}),[$,I]=(0,t.useState)({}),[F,T]=(0,t.useState)({}),[B,_]=(0,t.useState)(!1),[P,D]=(0,t.useState)({}),K=(e,r)=>{z(l=>({...l,[e]:r}))},M=async(e,r)=>{let l=r.target.files[0];if(!l)return;I(r=>({...r,[e]:l}));let i=new FormData;i.append("file",l);try{T(r=>({...r,[e]:0}));let r=await a.A.post("https://takbon.biz:3402/uploads",i,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{let l=Math.round(100*r.loaded/r.total);T(r=>({...r,[e]:l}))}});K(e,r.data.key),C.oR.success("تصویر با موفقیت آپلود شد"),T(r=>({...r,[e]:0}))}catch(e){console.error(e),C.oR.error("خطا در آپلود تصویر")}},E=async r=>{r.preventDefault(),_(!0);try{await a.A.post(e,W),C.oR.success("آیتم با موفقیت اضافه شد"),d(),l()}catch(e){console.error(e),C.oR.error("خطا در ذخیره‌سازی آیتم")}finally{_(!1)}};return r.filter(e=>"image"===e.field).some(e=>W[e.field]&&W[`${e.field}Title`]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(s.A,{open:w,onClose:l,maxWidth:"sm",fullWidth:!0,TransitionComponent:R,dir:"rtl",children:[(0,i.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"right"},children:["افزودن آیتم جدید",(0,i.jsx)(x.A,{title:"بستن",children:(0,i.jsx)(h.A,{onClick:l,children:(0,i.jsx)(k.m6K,{size:24})})})]}),(0,i.jsxs)("form",{onSubmit:E,children:[(0,i.jsx)(f.A,{dividers:!0,children:(0,i.jsx)(u.A,{spacing:3,children:r.map(e=>{if("image"===e.field)return(0,i.jsx)(S,{col:e,formValues:W,imageFiles:$[e.field],uploadProgress:F[e.field]||0,onImageChange:r=>M(e.field,r),onTitleChange:r=>K(`${e.field}Title`,r.target.value)},e.field);if("imagemain"===e.field)return(0,i.jsxs)(p.A,{fullWidth:!0,children:[(0,i.jsx)(m.A,{id:`${e.field}-label`,children:e.header}),(0,i.jsx)(g.A,{labelId:`${e.field}-label`,multiple:!0,value:Array.isArray(W[e.field])?W[e.field]:[],label:e.header,onChange:r=>K(e.field,r.target.value),sx:{borderRadius:3,background:"rgba(255,255,255,0.15)",backdropFilter:"blur(6px)","& .MuiSelect-select":{display:"flex",gap:1}},renderValue:r=>(0,i.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.map(r=>{let l=e.options.find(e=>e.code===r);return l?(0,i.jsx)(o.A,{component:"img",src:`https://takbon.biz/images/${l.name}`,alt:l.name,sx:{width:48,height:48,borderRadius:"50%",objectFit:"cover",border:"2px solid #1976d2",boxShadow:"0 2px 8px rgba(25,118,210,0.3)",transition:"transform 0.3s ease","&:hover":{transform:"scale(1.1)"}}},r):null})}),children:e.options.map(r=>(0,i.jsxs)(b.A,{value:r.code,children:[(0,i.jsx)(j.A,{checked:W[e.field]?.includes(r.code),color:"primary"}),(0,i.jsx)(o.A,{component:"img",src:`https://takbon.biz/images/${r.name}`,alt:r.name,sx:{width:40,height:40,objectFit:"cover",borderRadius:"50%",mr:1,border:"1px solid #ccc"}}),(0,i.jsx)(n.A,{variant:"body2",children:r.name})]},r.code))})]},e.field);if("target"===e.field||"target_en"===e.field){let r=Array.isArray(W[e.field])?W[e.field]:[];return(0,i.jsxs)(o.A,{children:[(0,i.jsx)(n.A,{variant:"subtitle2",sx:{mb:1},children:e.header}),r.length>0?r.map((l,t)=>(0,i.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[(0,i.jsxs)(n.A,{sx:{width:24,textAlign:"center",userSelect:"none"},color:"text.secondary",children:[t+1,"."]}),(0,i.jsx)(A.A,{size:"small",fullWidth:!0,value:l,onChange:l=>{let i=[...r];i[t]=l.target.value,K(e.field,i)}}),(0,i.jsx)(x.A,{title:"حذف",children:(0,i.jsx)(h.A,{size:"small",color:"error",onClick:()=>{let l=[...r];l.splice(t,1),K(e.field,l)},children:(0,i.jsx)(k.m6K,{})})})]},`${e.field}-${t}`)):(0,i.jsx)(n.A,{variant:"caption",color:"text.secondary",children:"هیچ موردی ثبت نشده"}),(0,i.jsx)(y.A,{size:"small",variant:"outlined",sx:{mt:1},onClick:()=>K(e.field,[...r,""]),children:"افزودن مورد جدید"})]},e.field)}return e.options&&Array.isArray(e.options)?(0,i.jsxs)(p.A,{fullWidth:!0,children:[(0,i.jsx)(m.A,{id:`${e.field}-select-label`,children:e.header}),(0,i.jsx)(g.A,{labelId:`${e.field}-select-label`,value:W[e.field]||"",label:e.header,onChange:r=>K(e.field,r.target.value),children:e.options.map(e=>(0,i.jsx)(b.A,{value:e.code,children:e.name},e.code))})]},e.field):(0,i.jsx)(A.A,{label:e.header,fullWidth:!0,value:W[e.field]||"",onChange:r=>K(e.field,r.target.value),variant:"outlined",size:"small",multiline:!!P[e.field],minRows:P[e.field]?4:1,onKeyDown:r=>{"Enter"!==r.key||P[e.field]||(r.preventDefault(),D(r=>({...r,[e.field]:!0})))},sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backdropFilter:"blur(4px)",background:"rgba(255,255,255,0.3)","& fieldset":{borderColor:"primary.light"},"&:hover fieldset":{borderColor:"primary.main"},"&.Mui-focused fieldset":{borderColor:"primary.dark"}},direction:"rtl",textAlign:"right"}},e.field)})})}),(0,i.jsxs)(v.A,{children:[(0,i.jsx)(y.A,{onClick:l,startIcon:(0,i.jsx)(k.m6K,{}),sx:{px:3,py:1,borderRadius:3,background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.3)",color:"secondary.main",fontWeight:600,textTransform:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{background:"rgba(255, 255, 255, 0.25)",boxShadow:"0 6px 16px rgba(0,0,0,0.15)",borderColor:"secondary.main",color:"secondary.dark"},"& svg":{transition:"transform 0.3s ease"},"&:hover svg":{transform:"rotate(-90deg)"}},children:"لغو"}),(0,i.jsx)(y.A,{type:"submit",variant:"contained",sx:{background:"linear-gradient(135deg, #1976d2, #42a5f5)",color:"#fff",px:4,boxShadow:"0 4px 12px rgba(25, 118, 210, 0.4)",transition:"all 0.3s ease","&:hover":{background:"linear-gradient(135deg, #1565c0, #1e88e5)",boxShadow:"0 6px 16px rgba(25, 118, 210, 0.6)"}},children:B?"در حال ذخیره...":"ذخیره"})]})]})]})})};var z=l(79534),$=l(80842),I=l(89638),F=l(33125),T=l(77567),B=l(30474);let _=({url:e,columns:r,title:l})=>{let[d,x]=(0,t.useState)([]),[h,k]=(0,t.useState)(null),[w,R]=(0,t.useState)({}),[S,_]=(0,t.useState)(!1),[P,D]=(0,t.useState)(0),[K,M]=(0,t.useState)(!1),E=(0,t.useCallback)(()=>{a.A.get(e).then(e=>{e.data&&Array.isArray(e.data.value)?x(e.data.value):(console.error("فرمت دیتا معتبر نیست:",e.data),C.oR.error("فرمت داده دریافتی معتبر نیست"))}).catch(e=>{console.error("خطا در دریافت API:",e),C.oR.error("خطا در دریافت داده از سرور")})},[e]);(0,t.useEffect)(()=>{E()},[E]);let V=(e,r)=>{k(e),R({...r}),D(0),M(!0)},U=()=>{k(null),R({}),D(0),C.oR.info("ویرایش لغو شد")},G=(e,r)=>{R(l=>({...l,[e]:r}))},N=async(e,r)=>{let l=e.target.files[0];if(l)try{let e=new FormData;e.append("file",l);let i=await a.A.post("https://takbon.biz:3402/uploads",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let r=Math.round(100*e.loaded/e.total);D(r)}});C.oR.success("تصویر با موفقیت آپلود شد"),R(e=>({...e,[r]:i.data.key}))}catch(e){console.error("خطا در آپلود تصویر:",e),C.oR.error("خطا در آپلود تصویر")}},O=async r=>{try{(await a.A.post(e,w,{headers:{"Content-Type":"application/json"}})).data&&(x(e=>e.map(e=>e._id===r?{...e,...w}:e)),k(null),R({}),C.oR.success("اطلاعات با موفقیت ویرایش شد"))}catch(e){console.error("خطا در ویرایش:",e),C.oR.error("خطا در ویرایش اطلاعات")}},X=r=>{T.A.fire({title:"آیا مطمئن هستید؟",text:"این عملیات قابل بازگشت نیست!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، حذف کن!",cancelButtonText:"لغو"}).then(l=>{l.isConfirmed&&a.A.delete(`${e}/?id=${r}`).then(()=>{x(e=>e.filter(e=>e._id!==r)),T.A.fire({icon:"success",title:"حذف شد!",text:"آیتم با موفقیت حذف شد.",confirmButtonText:"باشه"})}).catch(e=>{console.error("خطا در حذف:",e),T.A.fire({icon:"error",title:"خطا",text:"خطا در حذف آیتم",confirmButtonText:"باشه"})})})},q=(e,r)=>{if("image"===e.field){if(r[e.field]){let l=`https://takbon.biz/images/${r[e.field]}`;return(0,i.jsx)(B.default,{src:l,alt:e.field,style:{width:100,height:100,borderRadius:15,objectFit:"cover",cursor:"pointer"},onDoubleClick:()=>window.open(l,"_blank")})}return(0,i.jsx)(n.A,{variant:"body2",color:"text.secondary",children:"بدون تصویر"})}return e.render?e.render(r):r[e.field]};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.A,{p:3,children:[(0,i.jsx)(C.N9,{rtl:!0,position:"bottom-left"}),(0,i.jsx)(n.A,{variant:"h5",mb:2,children:l}),(0,i.jsx)(y.A,{variant:"contained",onClick:()=>_(!0),children:"+ افزودن"}),S&&(0,i.jsx)(W,{url:e,columns:r,onClose:()=>_(!1),onAdd:E,open:S}),(0,i.jsx)(u.A,{spacing:2,mt:2,children:d.map(e=>(0,i.jsxs)(z.A,{sx:{p:2,border:h===e._id?"2px solid #1976d2":"1px solid #ddd"},children:[r.map(r=>(0,i.jsxs)(o.A,{mb:1,children:[(0,i.jsxs)(n.A,{fontSize:14,fontWeight:600,children:[r.header,":"]}),(0,i.jsx)(n.A,{variant:"body2",color:"text.secondary",children:q(r,e)})]},r.field)),(0,i.jsxs)(u.A,{direction:"row",spacing:1,mt:1,children:[(0,i.jsx)(y.A,{variant:"outlined",color:"warning",onClick:()=>V(e._id,e),startIcon:(0,i.jsx)(I.A,{}),children:"ویرایش"}),(0,i.jsx)(y.A,{variant:"outlined",color:"error",onClick:()=>X(e._id),startIcon:(0,i.jsx)(F.A,{}),children:"حذف"})]})]},e._id))})]}),(0,i.jsxs)(s.A,{open:K,onClose:()=>M(!1),maxWidth:"md",fullWidth:!0,children:[(0,i.jsx)(c.A,{children:"ویرایش "}),(0,i.jsx)(f.A,{dividers:!0,children:r.map(e=>(0,i.jsxs)(o.A,{mb:2,children:[(0,i.jsxs)(n.A,{fontSize:14,fontWeight:600,children:[e.header,":"]}),"image"===e.field?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)($.A,{type:"file",fullWidth:!0,inputProps:{accept:"image/*"},onChange:r=>N(r,e.field)}),P>0&&P<100&&(0,i.jsxs)(n.A,{mt:1,children:["آپلود: ",P,"%"]}),w[e.field]&&(0,i.jsx)(o.A,{mt:1,children:(0,i.jsx)(B.default,{src:`https://takbon.biz/images/${w[e.field]}`,alt:"preview",style:{width:100,height:100,objectFit:"cover",borderRadius:8}})})]}):"target"===e.field||"target_en"===e.field?(0,i.jsxs)(o.A,{children:[w[e.field]&&w[e.field].length>0?w[e.field].map((r,l)=>(0,i.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,i.jsx)(A.A,{value:r,size:"small",fullWidth:!0,multiline:!0,minRows:r.length>200?5:3,maxRows:10,onChange:r=>{let i=[...w[e.field]];i[l]=r.target.value,G(e.field,i)}}),(0,i.jsx)(y.A,{color:"error",size:"small",sx:{ml:1},onClick:()=>{let r=[...w[e.field]];r.splice(l,1),G(e.field,r)},children:"✕"})]},l)):(0,i.jsx)(n.A,{color:"text.secondary",variant:"caption",children:"هیچ موردی ثبت نشده است"}),(0,i.jsx)(y.A,{size:"small",variant:"outlined",onClick:()=>G(e.field,[...w[e.field]||[],""]),children:"افزودن مورد جدید"})]}):"imagemain"===e.field?(0,i.jsx)(p.A,{fullWidth:!0,children:(0,i.jsx)(g.A,{multiple:!0,value:Array.isArray(w[e.field])?w[e.field]:[],onChange:r=>G(e.field,r.target.value),renderValue:r=>(0,i.jsx)(o.A,{sx:{display:"flex",gap:1,justifyContent:"flex-start",alignItems:"center",flexWrap:"nowrap",overflowX:"auto",p:.5},children:r.map(r=>{let l=e.options.find(e=>e.code===r);return l?(0,i.jsx)(B.default,{src:`https://takbon.biz/images/${l.name}`,alt:l.name,style:{width:80,height:80,objectFit:"cover",borderRadius:"50%",border:"2px solid #1976d2",flexShrink:0}},r):null})}),children:e.options.map(r=>(0,i.jsxs)(b.A,{value:r.code,children:[(0,i.jsx)(j.A,{checked:w[e.field]?.includes(r.code)}),(0,i.jsx)(B.default,{ش:!0,src:`https://takbon.biz/images/${r.name}`,alt:r.name,style:{width:40,height:40,objectFit:"cover",borderRadius:"50%",marginRight:8}})]},r.code))})}):"external_id"===e.field?(0,i.jsxs)(p.A,{fullWidth:!0,children:[(0,i.jsx)(m.A,{children:e.header}),(0,i.jsx)(g.A,{value:w[e.field]||"",label:e.header,onChange:r=>G(e.field,r.target.value),children:e.options.map(e=>(0,i.jsx)(b.A,{value:e.code,children:e.name},e.code))})]}):(0,i.jsx)(A.A,{fullWidth:!0,multiline:!0,minRows:(w[e.field]?.length||0)>200?5:3,maxRows:10,value:w[e.field]||"",onChange:r=>G(e.field,r.target.value)})]},e.field))}),(0,i.jsxs)(v.A,{children:[(0,i.jsx)(y.A,{onClick:()=>{O(h),M(!1)},variant:"contained",color:"success",children:"ذخیره"}),(0,i.jsx)(y.A,{onClick:()=>{U(),M(!1)},variant:"outlined",color:"secondary",children:"لغو"})]})]})]})}}};