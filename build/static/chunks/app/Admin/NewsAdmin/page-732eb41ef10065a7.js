(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4687],{38752:(e,t,a)=>{Promise.resolve().then(a.bind(a,72051))},72051:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var l=a(95155),s=a(12115),o=a(79489),r=a(43626),n=a(83776),c=a.n(n),i=a(15444),d=a.n(i);function u(e){let{value:t,onChange:a,label:o}=e,[n,i]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(t){let e=t.split("/");3===e.length&&i("".concat(e[0],"/").concat(e[1].padStart(2,"0"),"/").concat(e[2].padStart(2,"0")))}},[t]),(0,l.jsx)("div",{className:"flex flex-col gap-1 text-right",children:(0,l.jsx)(r.Ay,{value:n,onChange:e=>{if(i(e),!e)return void a("");a("".concat(e.year,"/").concat(String(e.month).padStart(2,"0"),"/").concat(String(e.day).padStart(2,"0")))},calendar:c(),locale:d(),calendarPosition:"bottom-right",className:"teal",placeholder:"انتخاب تاریخ",editable:!1})})}a(43963);var p=a(23464),h=a(52615),m=a(66766);function x(e){let{onTaskAdded:t}=e,[a,r]=(0,s.useState)(""),[n,c]=(0,s.useState)(""),[i,d]=(0,s.useState)(""),[x,g]=(0,s.useState)(""),[b,f]=(0,s.useState)(""),[y,j]=(0,s.useState)(""),[v,N]=(0,s.useState)(!1),[w,k]=(0,s.useState)(0),[C,S]=(0,s.useState)([]),z=async e=>{e.preventDefault(),N(!0),f(""),j("");try{let e=await o.A.post("https://takbon.biz:3402/news",{title:a,content:n,image:i,publish:x,gallery:C});console.log("خبر جدید اضافه شده:",e.data),j("خبر با موفقیت اضافه شد!"),r(""),c(""),d(""),g(""),t&&t(e.data)}catch(e){console.error(e),f("خطا در افزودن خبر")}finally{N(!1)}},A=async e=>{let t=Array.from(e.target.files);if(0===t.length)return;k(0);let a=[];for(let e=0;e<t.length;e++){let l=new FormData;l.append("file",t[e]);try{let t=await p.A.post("https://takbon.biz:3402/uploads",l,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let t=Math.round(100*e.loaded/e.total);k(t)}}),s=t.data.key||t.data.filename||t.data.fileName;a.push("images/".concat(s)),h.oR.success("تصویر ".concat(e+1," با موفقیت آپلود شد"))}catch(t){console.error(t),h.oR.error("خطا در آپلود تصویر ".concat(e+1))}}S(e=>[...e,...a]),k(0)},_=async e=>{let t=e.target.files[0];if(!t)return;let a=new FormData;a.append("file",t);try{k(0);let e=await p.A.post("https://takbon.biz:3402/uploads",a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let t=Math.round(100*e.loaded/e.total);k(t)}}),t=e.data.key||e.data.filename||e.data.fileName;d("images/".concat(t)),h.oR.success("تصویر با موفقیت آپلود شد"),k(0)}catch(e){console.error(e),h.oR.error("خطا در آپلود تصویر")}};return(0,l.jsxs)("form",{onSubmit:z,className:"flex flex-col gap-2 p-4 border rounded w-80",children:[(0,l.jsx)("input",{type:"text",value:a,onChange:e=>r(e.target.value),placeholder:"عنوان",className:"border p-2 rounded",required:!0}),(0,l.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),placeholder:"شرح",className:"border p-2 rounded",required:!0}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:_,className:"border p-2 rounded"}),w>0&&w<100&&(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["در حال آپلود: ",w,"%"]}),i&&(0,l.jsx)(m.default,{src:"https://takbon.biz/".concat(i),alt:"تصویر انتخابی",className:"w-full h-40 object-cover rounded"}),(0,l.jsx)(u,{value:x,onChange:g,label:"تاریخ انتشار (شمسی)"}),(0,l.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:A,className:"border p-2 rounded"}),C.length>0&&(0,l.jsx)("div",{className:"grid grid-cols-3 gap-2 mt-2 mb-2",children:C.map((e,t)=>(0,l.jsx)(m.default,{src:"https://takbon.biz/".concat(e),alt:"gallery-preview-".concat(t),className:"w-full h-20 object-cover rounded"},t))}),(0,l.jsx)("button",{type:"submit",disabled:v,className:"bg-blue-500 text-white p-2 rounded hover:bg-blue-600 disabled:opacity-50",children:v?"در حال ارسال...":"افزودن خبر"}),b&&(0,l.jsx)("p",{className:"text-red-500",children:b}),y&&(0,l.jsx)("p",{className:"text-green-500",children:y})]})}function g(e){let{item:t,onCancel:a,onSave:o}=e,[r,n]=(0,s.useState)(0),[c,i]=(0,s.useState)({title:t.title,content:t.content,image:t.image,publish:t.publish||""}),[d,x]=(0,s.useState)(t.gallery||[]),g=async e=>{let t=e.target.files[0];if(t)try{let e=new FormData;e.append("file",t);let a=await p.A.post("https://takbon.biz:3402/uploads",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let t=Math.round(100*e.loaded/e.total);n(t)}});h.oR.success("تصویر با موفقیت آپلود شد");let l=a.data.key||a.data.filename||a.data.fileName,s="images/".concat(l);x(e=>[...e,s])}catch(e){console.error("خطا در آپلود تصویر:",e),h.oR.error("خطا در آپلود تصویر")}finally{n(0)}},b=e=>{x(t=>t.filter((t,a)=>a!==e))},f=async(e,t)=>{let a=e.target.files[0];if(a)try{let e=new FormData;e.append("file",a);let l=await p.A.post("https://takbon.biz:3402/uploads",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let t=Math.round(100*e.loaded/e.total);n(t)}});h.oR.success("تصویر با موفقیت آپلود شد");let s=l.data.key||l.data.filename||l.data.fileName,o="images/".concat(s);i(e=>({...e,[t]:o}))}catch(e){console.error("خطا در آپلود تصویر:",e),h.oR.error("خطا در آپلود تصویر")}};return(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[c.image&&(0,l.jsx)(m.default,{src:"https://takbon.biz/".concat(c.image),alt:c.title,className:"w-full h-32 object-cover rounded"}),(0,l.jsx)("input",{type:"text",value:c.title,onChange:e=>i(t=>({...t,title:e.target.value})),className:"border p-1 rounded"}),(0,l.jsx)("textarea",{value:c.content,onChange:e=>i(t=>({...t,content:e.target.value})),className:"border p-1 rounded",rows:10}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("label",{className:"text-sm",children:"تاریخ انتشار (شمسی)"}),(0,l.jsx)(u,{value:c.publish,onChange:e=>i(t=>({...t,publish:e})),label:"تاریخ انتشار (شمسی)"})]}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>f(e,"image"),className:"border p-1 rounded"}),r>0&&r<100&&(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["در حال آپلود: ",r,"%"]}),(0,l.jsx)("label",{className:"mt-2 mb-1 font-semibold",children:"گالری تصاویر"}),(0,l.jsx)("div",{className:"gallery grid grid-cols-4 gap-2 mb-2",children:d.map((e,t)=>(0,l.jsxs)("div",{className:"relative group",children:[(0,l.jsx)(m.default,{src:"https://takbon.biz/".concat(e),alt:"gallery-".concat(t),className:"w-full h-20 object-cover rounded"}),(0,l.jsx)("button",{type:"button",onClick:()=>b(t),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition",title:"حذف تصویر",children:"\xd7"})]},t))}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:g,className:"border p-1 rounded"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm",onClick:()=>{let e={...t,...c,gallery:d};o(t._id,e)},children:"ذخیره"}),(0,l.jsx)("button",{className:"bg-gray-300 text-black px-2 py-1 rounded hover:bg-gray-400 text-sm",onClick:a,children:"لغو"})]})]})}var b=a(24752),f=a.n(b),y=a(29911);function j(e){let{images:t,initialIndex:a=0,onClose:o}=e;if(!t||!Array.isArray(t)||0===t.length)return null;let[r,n]=(0,s.useState)(a);return(0,l.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50",onClick:o,children:[(0,l.jsxs)("div",{className:"relative max-w-full max-h-[90vh] flex items-center justify-center p-4",children:[(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),o()},className:"absolute top-4 right-4 text-white text-2xl hover:text-red-400",children:(0,l.jsx)(y.QCr,{})}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),n(e=>(e-1+t.length)%t.length)},className:"absolute left-4 text-white text-4xl hover:text-yellow-400",children:(0,l.jsx)(y.Z0P,{})}),(0,l.jsx)(m.default,{src:t[r],alt:"gallery-".concat(r),className:"max-h-[80vh] max-w-full rounded shadow-lg object-contain",onClick:e=>e.stopPropagation()}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),n(e=>(e+1)%t.length)},className:"absolute right-4 text-white text-4xl hover:text-yellow-400",children:(0,l.jsx)(y.QVr,{})})]}),(0,l.jsxs)("p",{className:"absolute bottom-4 text-white text-sm bg-black bg-opacity-50 px-3 py-1 rounded",children:[r+1," از ",t.length]})]})}function v(){let[e,t]=(0,s.useState)([]),[a,r]=(0,s.useState)(!0),[n,c]=(0,s.useState)(!1),[i,d]=(0,s.useState)(null),[u,p]=(0,s.useState)([]),[h,b]=(0,s.useState)(!1),[y,v]=(0,s.useState)(0),N=(e,t)=>{p(e),v(t),b(!0)};(0,s.useEffect)(()=>{o.A.get("https://takbon.biz:3402/news").then(e=>{t(e.data.value),r(!1)}).catch(e=>{console.error(e),r(!1)})},[]);let w=async e=>{r(!0);try{let e=await o.A.get("https://takbon.biz:3402/news");t(e.data.value),c(!1)}catch(e){console.error(e)}finally{r(!1)}},k=async(e,a)=>{try{(await o.A.post("https://takbon.biz:3402/news",a)).data,t(t=>t.map(t=>t._id===e?{...t,...a}:t)),d(null)}catch(e){console.error("خطا در بروزرسانی خبر:",e)}},C=e=>{f().fire({title:"آیا مطمئن هستید؟",text:"این عملیات قابل بازگشت نیست!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، حذف کن!",cancelButtonText:"لغو"}).then(a=>{a.isConfirmed&&o.A.delete("https://takbon.biz:3402/news/?id=".concat(e)).then(()=>{t(t=>t.filter(t=>t._id!==e)),f().fire({icon:"success",title:"حذف شد!",text:"آیتم با موفقیت حذف شد.",confirmButtonText:"باشه"})}).catch(e=>{console.error("خطا در حذف:",e),f().fire({icon:"error",title:"خطا",text:"خطا در حذف آیتم",confirmButtonText:"باشه"})})})};return Array.isArray(e)?(0,l.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-extrabold text-gray-800",children:"مدیریت اخبار"}),(0,l.jsx)("button",{onClick:()=>c(e=>!e),className:"px-5 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:n?"بستن فرم افزودن":"افزودن خبر جدید"}),n&&(0,l.jsx)("div",{className:"w-full max-w-3xl",children:(0,l.jsx)(x,{onTaskAdded:w})})]}),(0,l.jsxs)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:[e.map(e=>(0,l.jsx)("div",{className:"border rounded-lg p-4 shadow hover:shadow-lg transition flex flex-col",children:i===e._id?(0,l.jsx)(g,{item:e,onCancel:()=>d(null),onSave:k},e._id):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h2",{className:"font-semibold mb-1",children:e.title}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:e.publish}),(0,l.jsx)(m.default,{src:"https://takbon.biz/".concat(e.image),alt:e.title,className:"w-full h-40 object-cover rounded-md mb-3 cursor-pointer",onDoubleClick:()=>N(["https://takbon.biz/".concat(e.image),...(e.gallery||[]).map(e=>"https://takbon.biz/".concat(e))],0)}),e.gallery&&e.gallery.length>0&&(0,l.jsx)("div",{className:"grid grid-cols-3 gap-2 mb-3",children:e.gallery.map((t,a)=>(0,l.jsx)(m.default,{src:"https://takbon.biz/".concat(t),alt:"gallery-".concat(a),className:"w-full h-20 object-cover rounded-md cursor-pointer",onDoubleClick:()=>N(["https://takbon.biz/".concat(e.image),...(e.gallery||[]).map(e=>"https://takbon.biz/".concat(e))],a+1)},a))}),(0,l.jsx)("p",{className:"text-sm text-gray-700 mb-3 line-clamp-3",children:e.content}),(0,l.jsxs)("div",{className:"mt-auto flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>d(e._id),className:"flex-1 bg-blue-600 text-white py-1 rounded hover:bg-blue-700 transition text-sm",children:"ویرایش"}),(0,l.jsx)("button",{onClick:()=>C(e._id),className:"flex-1 bg-red-600 text-white py-1 rounded hover:bg-red-700 transition text-sm",children:"حذف"})]})]})},e._id)),h&&u.length>0&&(0,l.jsx)(j,{images:u,initialIndex:y,onClose:()=>b(!1)})]})]}):(0,l.jsxs)("div",{children:["داده دریافتی آرایه نیست: ",JSON.stringify(e)]})}},79489:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var l=a(23464),s=a(52615);let o=l.A.create();o.interceptors.request.use(async e=>(e.headers={Authorization:localStorage.getItem("access_token"),Accept:"application/json"},e),e=>{Promise.reject(e)}),o.interceptors.response.use(e=>e,async e=>{let t=e.config;return e.response&&403===e.response.status&&!t._retry?(t._retry=!0,localStorage.clear(),s.oR.error("خطا احراز هویت"),window.location.replace("/Admin/login")):e.response&&401===e.response.status&&(localStorage.clear(),window.location.replace("/login")),Promise.reject(e)});let r=o}},e=>{var t=t=>e(e.s=t);e.O(0,[6682,8320,6711,3464,6766,2615,4562,8441,1684,7358],()=>t(38752)),_N_E=e.O()}]);