"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9824],{99824:(e,r,t)=>{t.d(r,{A:()=>D});var l=t(95155),i=t(12115),a=t(23464),n=t(52269),o=t(65358),d=t(7433),s=t(62861),c=t(62966),x=t(50514),h=t(44146),u=t(12422),f=t(35172),p=t(79799),m=t(80329),g=t(77486),b=t(37923),j=t(41892),A=t(73831),y=t(55857),v=t(78679),k=t(12515),C=t(52615);t(85716);var w=t(33106);let R=(0,i.forwardRef)(function(e,r){return(0,l.jsx)(w.A,{direction:"up",ref:r,...e})}),S=e=>{let{col:r,formValues:t,imageFiles:i,uploadProgress:a,onImageChange:s,onTitleChange:c}=e;return(0,l.jsxs)(n.A,{mb:3,children:[(0,l.jsx)(o.A,{variant:"subtitle1",gutterBottom:!0,fontWeight:"600",color:"primary",children:r.header}),(0,l.jsxs)(n.A,{sx:{border:"2px dashed",borderColor:a>0&&a<100?"primary.main":"grey.400",borderRadius:2,p:2,cursor:"pointer",display:"flex",alignItems:"center",gap:2,bgcolor:a>0&&a<100?"rgba(25, 118, 210, 0.1)":"transparent",transition:"all 0.3s ease","&:hover":{borderColor:"primary.dark",bgcolor:"rgba(25, 118, 210, 0.15)"}},onClick:()=>document.getElementById("upload-input-".concat(r.field)).click(),role:"button",tabIndex:0,onKeyPress:()=>document.getElementById("upload-input-".concat(r.field)).click(),children:[(0,l.jsx)(k.P4e,{size:32,color:"#1976d2"}),(0,l.jsxs)(o.A,{variant:"body1",color:"textSecondary",children:["برای آپلود ",r.header," کلیک کنید یا فایل را بکشید اینجا رها کنید"]}),(0,l.jsx)("input",{id:"upload-input-".concat(r.field),type:"file",accept:"image/*",onChange:s,style:{display:"none"}})]}),a>0&&a<100&&(0,l.jsxs)(n.A,{mt:1,children:[(0,l.jsx)(d.A,{variant:"determinate",value:a,color:"primary"}),(0,l.jsxs)(o.A,{variant:"body2",color:"primary",fontWeight:"600",mt:.5,children:["پیشرفت آپلود: ",a,"%"]})]}),i&&(0,l.jsxs)(n.A,{mt:2,display:"flex",alignItems:"center",gap:2,children:[(0,l.jsx)(n.A,{sx:{border:"2px dashed",borderColor:a>0&&a<100?"primary.main":"grey.400",borderRadius:3,p:2,cursor:"pointer",display:"flex",alignItems:"center",gap:2,background:"rgba(255,255,255,0.15)",backdropFilter:"blur(8px)",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",transition:"all 0.35s ease","&:hover":{borderColor:"primary.dark",background:"rgba(25,118,210,0.1)",boxShadow:"0 6px 24px rgba(25,118,210,0.2)"}}}),(0,l.jsx)(n.A,{flexGrow:1,children:t[r.field]&&(0,l.jsxs)(o.A,{variant:"caption",color:"success.main",sx:{fontWeight:600},children:["کلید فایل: ",t[r.field]]})})]})]})},W=e=>{let{url:r,columns:t,onClose:d,onAdd:w,open:W}=e,[z,I]=(0,i.useState)({}),[F,_]=(0,i.useState)({}),[T,B]=(0,i.useState)({}),[P,D]=(0,i.useState)(!1),[E,K]=(0,i.useState)({}),M=(e,r)=>{I(t=>({...t,[e]:r}))},N=async(e,r)=>{let t=r.target.files[0];if(!t)return;_(r=>({...r,[e]:t}));let l=new FormData;l.append("file",t);try{B(r=>({...r,[e]:0}));let r=await a.A.post("https://takbon.biz:3402/uploads",l,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r=>{let t=Math.round(100*r.loaded/r.total);B(r=>({...r,[e]:t}))}});M(e,r.data.key),C.oR.success("تصویر با موفقیت آپلود شد"),B(r=>({...r,[e]:0}))}catch(e){console.error(e),C.oR.error("خطا در آپلود تصویر")}},V=async e=>{e.preventDefault(),D(!0);try{await a.A.post(r,z),C.oR.success("آیتم با موفقیت اضافه شد"),w(),d()}catch(e){console.error(e),C.oR.error("خطا در ذخیره‌سازی آیتم")}finally{D(!1)}};return t.filter(e=>"image"===e.field).some(e=>z[e.field]&&z["".concat(e.field,"Title")]),(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(s.A,{open:W,onClose:d,maxWidth:"sm",fullWidth:!0,TransitionComponent:R,dir:"rtl",children:[(0,l.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",textAlign:"right"},children:["افزودن آیتم جدید",(0,l.jsx)(x.A,{title:"بستن",children:(0,l.jsx)(h.A,{onClick:d,children:(0,l.jsx)(k.m6K,{size:24})})})]}),(0,l.jsxs)("form",{onSubmit:V,children:[(0,l.jsx)(u.A,{dividers:!0,children:(0,l.jsx)(f.A,{spacing:3,children:t.map(e=>{if("image"===e.field)return(0,l.jsx)(S,{col:e,formValues:z,imageFiles:F[e.field],uploadProgress:T[e.field]||0,onImageChange:r=>N(e.field,r),onTitleChange:r=>M("".concat(e.field,"Title"),r.target.value)},e.field);if("imagemain"===e.field)return(0,l.jsxs)(p.A,{fullWidth:!0,children:[(0,l.jsx)(m.A,{id:"".concat(e.field,"-label"),children:e.header}),(0,l.jsx)(g.A,{labelId:"".concat(e.field,"-label"),multiple:!0,value:Array.isArray(z[e.field])?z[e.field]:[],label:e.header,onChange:r=>M(e.field,r.target.value),sx:{borderRadius:3,background:"rgba(255,255,255,0.15)",backdropFilter:"blur(6px)","& .MuiSelect-select":{display:"flex",gap:1}},renderValue:r=>(0,l.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.map(r=>{let t=e.options.find(e=>e.code===r);return t?(0,l.jsx)(n.A,{component:"img",src:"https://takbon.biz/images/".concat(t.name),alt:t.name,sx:{width:48,height:48,borderRadius:"50%",objectFit:"cover",border:"2px solid #1976d2",boxShadow:"0 2px 8px rgba(25,118,210,0.3)",transition:"transform 0.3s ease","&:hover":{transform:"scale(1.1)"}}},r):null})}),children:e.options.map(r=>{var t;return(0,l.jsxs)(b.A,{value:r.code,children:[(0,l.jsx)(j.A,{checked:null==(t=z[e.field])?void 0:t.includes(r.code),color:"primary"}),(0,l.jsx)(n.A,{component:"img",src:"https://takbon.biz/images/".concat(r.name),alt:r.name,sx:{width:40,height:40,objectFit:"cover",borderRadius:"50%",mr:1,border:"1px solid #ccc"}}),(0,l.jsx)(o.A,{variant:"body2",children:r.name})]},r.code)})})]},e.field);if("target"===e.field||"target_en"===e.field){let r=Array.isArray(z[e.field])?z[e.field]:[];return(0,l.jsxs)(n.A,{children:[(0,l.jsx)(o.A,{variant:"subtitle2",sx:{mb:1},children:e.header}),r.length>0?r.map((t,i)=>(0,l.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[(0,l.jsxs)(o.A,{sx:{width:24,textAlign:"center",userSelect:"none"},color:"text.secondary",children:[i+1,"."]}),(0,l.jsx)(A.A,{size:"small",fullWidth:!0,value:t,onChange:t=>{let l=[...r];l[i]=t.target.value,M(e.field,l)}}),(0,l.jsx)(x.A,{title:"حذف",children:(0,l.jsx)(h.A,{size:"small",color:"error",onClick:()=>{let t=[...r];t.splice(i,1),M(e.field,t)},children:(0,l.jsx)(k.m6K,{})})})]},"".concat(e.field,"-").concat(i))):(0,l.jsx)(o.A,{variant:"caption",color:"text.secondary",children:"هیچ موردی ثبت نشده"}),(0,l.jsx)(y.A,{size:"small",variant:"outlined",sx:{mt:1},onClick:()=>M(e.field,[...r,""]),children:"افزودن مورد جدید"})]},e.field)}return e.options&&Array.isArray(e.options)?(0,l.jsxs)(p.A,{fullWidth:!0,children:[(0,l.jsx)(m.A,{id:"".concat(e.field,"-select-label"),children:e.header}),(0,l.jsx)(g.A,{labelId:"".concat(e.field,"-select-label"),value:z[e.field]||"",label:e.header,onChange:r=>M(e.field,r.target.value),children:e.options.map(e=>(0,l.jsx)(b.A,{value:e.code,children:e.name},e.code))})]},e.field):(0,l.jsx)(A.A,{label:e.header,fullWidth:!0,value:z[e.field]||"",onChange:r=>M(e.field,r.target.value),variant:"outlined",size:"small",multiline:!!E[e.field],minRows:E[e.field]?4:1,onKeyDown:r=>{"Enter"!==r.key||E[e.field]||(r.preventDefault(),K(r=>({...r,[e.field]:!0})))},sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backdropFilter:"blur(4px)",background:"rgba(255,255,255,0.3)","& fieldset":{borderColor:"primary.light"},"&:hover fieldset":{borderColor:"primary.main"},"&.Mui-focused fieldset":{borderColor:"primary.dark"}},direction:"rtl",textAlign:"right"}},e.field)})})}),(0,l.jsxs)(v.A,{children:[(0,l.jsx)(y.A,{onClick:d,startIcon:(0,l.jsx)(k.m6K,{}),sx:{px:3,py:1,borderRadius:3,background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.3)",color:"secondary.main",fontWeight:600,textTransform:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{background:"rgba(255, 255, 255, 0.25)",boxShadow:"0 6px 16px rgba(0,0,0,0.15)",borderColor:"secondary.main",color:"secondary.dark"},"& svg":{transition:"transform 0.3s ease"},"&:hover svg":{transform:"rotate(-90deg)"}},children:"لغو"}),(0,l.jsx)(y.A,{type:"submit",variant:"contained",sx:{background:"linear-gradient(135deg, #1976d2, #42a5f5)",color:"#fff",px:4,boxShadow:"0 4px 12px rgba(25, 118, 210, 0.4)",transition:"all 0.3s ease","&:hover":{background:"linear-gradient(135deg, #1565c0, #1e88e5)",boxShadow:"0 6px 16px rgba(25, 118, 210, 0.6)"}},children:P?"در حال ذخیره...":"ذخیره"})]})]})]})})};var z=t(81063),I=t(58025),F=t(1384),_=t(71023),T=t(24752),B=t.n(T),P=t(66766);let D=e=>{let{url:r,columns:t,title:d}=e,[x,h]=(0,i.useState)([]),[k,w]=(0,i.useState)(null),[R,S]=(0,i.useState)({}),[T,D]=(0,i.useState)(!1),[E,K]=(0,i.useState)(0),[M,N]=(0,i.useState)(!1),V=(0,i.useCallback)(()=>{a.A.get(r).then(e=>{e.data&&Array.isArray(e.data.value)?h(e.data.value):(console.error("فرمت دیتا معتبر نیست:",e.data),C.oR.error("فرمت داده دریافتی معتبر نیست"))}).catch(e=>{console.error("خطا در دریافت API:",e),C.oR.error("خطا در دریافت داده از سرور")})},[r]);(0,i.useEffect)(()=>{V()},[V]);let U=(e,r)=>{w(e),S({...r}),K(0),N(!0)},G=()=>{w(null),S({}),K(0),C.oR.info("ویرایش لغو شد")},O=(e,r)=>{S(t=>({...t,[e]:r}))},X=async(e,r)=>{let t=e.target.files[0];if(t)try{let e=new FormData;e.append("file",t);let l=await a.A.post("https://takbon.biz:3402/uploads",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let r=Math.round(100*e.loaded/e.total);K(r)}});C.oR.success("تصویر با موفقیت آپلود شد"),S(e=>({...e,[r]:l.data.key}))}catch(e){console.error("خطا در آپلود تصویر:",e),C.oR.error("خطا در آپلود تصویر")}},q=async e=>{try{(await a.A.post(r,R,{headers:{"Content-Type":"application/json"}})).data&&(h(r=>r.map(r=>r._id===e?{...r,...R}:r)),w(null),S({}),C.oR.success("اطلاعات با موفقیت ویرایش شد"))}catch(e){console.error("خطا در ویرایش:",e),C.oR.error("خطا در ویرایش اطلاعات")}},H=e=>{B().fire({title:"آیا مطمئن هستید؟",text:"این عملیات قابل بازگشت نیست!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"بله، حذف کن!",cancelButtonText:"لغو"}).then(t=>{t.isConfirmed&&a.A.delete("".concat(r,"/?id=").concat(e)).then(()=>{h(r=>r.filter(r=>r._id!==e)),B().fire({icon:"success",title:"حذف شد!",text:"آیتم با موفقیت حذف شد.",confirmButtonText:"باشه"})}).catch(e=>{console.error("خطا در حذف:",e),B().fire({icon:"error",title:"خطا",text:"خطا در حذف آیتم",confirmButtonText:"باشه"})})})},J=(e,r)=>{if("image"===e.field){if(r[e.field]){let t="https://takbon.biz/images/".concat(r[e.field]);return(0,l.jsx)(P.default,{src:t,alt:e.field,style:{width:100,height:100,borderRadius:15,objectFit:"cover",cursor:"pointer"},onDoubleClick:()=>window.open(t,"_blank")})}return(0,l.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"بدون تصویر"})}return e.render?e.render(r):r[e.field]};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.A,{p:3,children:[(0,l.jsx)(C.N9,{rtl:!0,position:"bottom-left"}),(0,l.jsx)(o.A,{variant:"h5",mb:2,children:d}),(0,l.jsx)(y.A,{variant:"contained",onClick:()=>D(!0),children:"+ افزودن"}),T&&(0,l.jsx)(W,{url:r,columns:t,onClose:()=>D(!1),onAdd:V,open:T}),(0,l.jsx)(f.A,{spacing:2,mt:2,children:x.map(e=>(0,l.jsxs)(z.A,{sx:{p:2,border:k===e._id?"2px solid #1976d2":"1px solid #ddd"},children:[t.map(r=>(0,l.jsxs)(n.A,{mb:1,children:[(0,l.jsxs)(o.A,{fontSize:14,fontWeight:600,children:[r.header,":"]}),(0,l.jsx)(o.A,{variant:"body2",color:"text.secondary",children:J(r,e)})]},r.field)),(0,l.jsxs)(f.A,{direction:"row",spacing:1,mt:1,children:[(0,l.jsx)(y.A,{variant:"outlined",color:"warning",onClick:()=>U(e._id,e),startIcon:(0,l.jsx)(F.A,{}),children:"ویرایش"}),(0,l.jsx)(y.A,{variant:"outlined",color:"error",onClick:()=>H(e._id),startIcon:(0,l.jsx)(_.A,{}),children:"حذف"})]})]},e._id))})]}),(0,l.jsxs)(s.A,{open:M,onClose:()=>N(!1),maxWidth:"md",fullWidth:!0,children:[(0,l.jsx)(c.A,{children:"ویرایش "}),(0,l.jsx)(u.A,{dividers:!0,children:t.map(e=>{var r;return(0,l.jsxs)(n.A,{mb:2,children:[(0,l.jsxs)(o.A,{fontSize:14,fontWeight:600,children:[e.header,":"]}),"image"===e.field?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(I.A,{type:"file",fullWidth:!0,inputProps:{accept:"image/*"},onChange:r=>X(r,e.field)}),E>0&&E<100&&(0,l.jsxs)(o.A,{mt:1,children:["آپلود: ",E,"%"]}),R[e.field]&&(0,l.jsx)(n.A,{mt:1,children:(0,l.jsx)(P.default,{src:"https://takbon.biz/images/".concat(R[e.field]),alt:"preview",style:{width:100,height:100,objectFit:"cover",borderRadius:8}})})]}):"target"===e.field||"target_en"===e.field?(0,l.jsxs)(n.A,{children:[R[e.field]&&R[e.field].length>0?R[e.field].map((r,t)=>(0,l.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,l.jsx)(A.A,{value:r,size:"small",fullWidth:!0,multiline:!0,minRows:r.length>200?5:3,maxRows:10,onChange:r=>{let l=[...R[e.field]];l[t]=r.target.value,O(e.field,l)}}),(0,l.jsx)(y.A,{color:"error",size:"small",sx:{ml:1},onClick:()=>{let r=[...R[e.field]];r.splice(t,1),O(e.field,r)},children:"✕"})]},t)):(0,l.jsx)(o.A,{color:"text.secondary",variant:"caption",children:"هیچ موردی ثبت نشده است"}),(0,l.jsx)(y.A,{size:"small",variant:"outlined",onClick:()=>O(e.field,[...R[e.field]||[],""]),children:"افزودن مورد جدید"})]}):"imagemain"===e.field?(0,l.jsx)(p.A,{fullWidth:!0,children:(0,l.jsx)(g.A,{multiple:!0,value:Array.isArray(R[e.field])?R[e.field]:[],onChange:r=>O(e.field,r.target.value),renderValue:r=>(0,l.jsx)(n.A,{sx:{display:"flex",gap:1,justifyContent:"flex-start",alignItems:"center",flexWrap:"nowrap",overflowX:"auto",p:.5},children:r.map(r=>{let t=e.options.find(e=>e.code===r);return t?(0,l.jsx)(P.default,{src:"https://takbon.biz/images/".concat(t.name),alt:t.name,style:{width:80,height:80,objectFit:"cover",borderRadius:"50%",border:"2px solid #1976d2",flexShrink:0}},r):null})}),children:e.options.map(r=>{var t;return(0,l.jsxs)(b.A,{value:r.code,children:[(0,l.jsx)(j.A,{checked:null==(t=R[e.field])?void 0:t.includes(r.code)}),(0,l.jsx)(P.default,{ش:!0,src:"https://takbon.biz/images/".concat(r.name),alt:r.name,style:{width:40,height:40,objectFit:"cover",borderRadius:"50%",marginRight:8}})]},r.code)})})}):"external_id"===e.field?(0,l.jsxs)(p.A,{fullWidth:!0,children:[(0,l.jsx)(m.A,{children:e.header}),(0,l.jsx)(g.A,{value:R[e.field]||"",label:e.header,onChange:r=>O(e.field,r.target.value),children:e.options.map(e=>(0,l.jsx)(b.A,{value:e.code,children:e.name},e.code))})]}):(0,l.jsx)(A.A,{fullWidth:!0,multiline:!0,minRows:((null==(r=R[e.field])?void 0:r.length)||0)>200?5:3,maxRows:10,value:R[e.field]||"",onChange:r=>O(e.field,r.target.value)})]},e.field)})}),(0,l.jsxs)(v.A,{children:[(0,l.jsx)(y.A,{onClick:()=>{q(k),N(!1)},variant:"contained",color:"success",children:"ذخیره"}),(0,l.jsx)(y.A,{onClick:()=>{G(),N(!1)},variant:"outlined",color:"secondary",children:"لغو"})]})]})]})}}}]);